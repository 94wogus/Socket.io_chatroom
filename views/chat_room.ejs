<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>
            Chat room
        </title>
    </head>
    <body>
        <h2>Select chat room</h2>
        <select id="room_select">
            <option value="room_0">Room 0</option>
            <option value="room_1">Room 1</option>
        </select>
        <form action='/' method='POST'>
            <input type='text' id='send_msg'>
            <input type='submit' value='Send'>
        </form>
        <ul id="chat_log"></ul>
        Test
        <script src='/socket.io/socket.io.js'></script>
        <script src='http://code.jquery.com/jquery-1.11.1.js'></script>
        <script>
            $(function(){
                const usr_name = prompt("Input your name.");
                var cnt = 0;
                var socket = io();
                socket.emit('joinRoom', usr_name, cnt); // 최초 join
                $('#room_select').change(() => {
                    socket.emit('leaveRoom', usr_name, cnt); //callback function 있어도 되고 없어도 되고
                    cnt++;
                    cnt = cnt % 2; // 대화방 싹 지울수는 없나
                    socket.emit('joinRoom', usr_name, cnt);
                });
                $('form').submit(() => {
                    socket.emit('chat message', $('#send_msg').val(), usr_name, cnt);
                    $('#send_msg').val('');
                    return false;
                });
                socket.on('leaveRoom', (name, num) => {
                    console.log('leave');
                    $('#chat_log').append($('<li>').text('User ' + name + ' has left room ' + num));
                });
                socket.on('joinRoom', (name, num) => {
                    console.log('join');
                    $('#chat_log').append($('<li>').text('User ' + name + ' has joined room ' + num));
                });
                socket.on('chat message', (msg, name, num) => {
                    console.log('chat');
                    $('#chat_log').append($('<li>').text("User (" + name + "): " + msg));
                });
            });
        </script>
    </body>
</html>